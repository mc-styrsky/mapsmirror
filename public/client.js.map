{
  "version": 3,
  "sources": ["../src/common/extractProperties.ts", "../src/client/createHTMLElement.ts", "../src/client/index.ts"],
  "sourcesContent": ["export function extractProperties<T extends object> (\n  obj: Record<string, any>,\n  builder: { [P in keyof T]: (val?: any) => T[P] },\n): T {\n  return Object.entries(builder).reduce((ret, entry) => {\n    const [key, constructor]: [string, any] = entry;\n    ret[key] = constructor(obj[key]);\n    return ret;\n  }, {} as T);\n}\n", "export function createHTMLElement<T extends keyof HTMLElementTagNameMap> (params: Partial<Omit<HTMLElementTagNameMap[T], 'dataset' | 'style'>> & {\n  classes?: string[];\n  dataset?: Partial<HTMLElementTagNameMap[T]['dataset']>,\n  style?: Partial<HTMLElementTagNameMap[T]['style']>;\n  tag: T;\n  zhilds?: (HTMLElement | string | null | undefined)[];\n}): HTMLElementTagNameMap[T] {\n  const { classes, dataset, style, tag, zhilds, ...data } = params;\n\n  const element = document.createElement(tag);\n\n  Object.entries(data).forEach(([k, v]) => element[k] = v);\n\n  if (classes) classes.forEach(c => element.classList.add(c));\n  if (dataset) Object.entries(dataset).forEach(([k, v]) => element.dataset[k] = v);\n  if (style) Object.entries(style).forEach(([k, v]) => element.style[k] = v);\n  if (zhilds) zhilds.forEach(child => {\n    if (!child) return;\n    if (typeof child === 'string') element.append(document.createTextNode(child));\n    else element.append(child);\n  });\n  return element;\n}\n", "import { extractProperties } from '../common/extractProperties';\nimport { createHTMLElement } from './createHTMLElement';\nconst {\n  container: containerId = '',\n} = Object.fromEntries(new URL(import.meta.url).searchParams.entries());\n\nconst container = document.getElementById(containerId);\n\nconsole.log(Object.fromEntries(new URL(window.location.href).searchParams.entries()));\nconst position = extractProperties(Object.fromEntries(new URL(window.location.href).searchParams.entries()), {\n  source: val => String(val ?? 'osm'),\n  x: val => Number(val ?? 2),\n  y: val => Number(val ?? 2),\n  z: val => Number(val ?? 2),\n});\n\nconst tileSize = 256;\n\nconst createImages = ({\n  centerX,\n  centerY,\n  countX,\n  countY,\n  x,\n  y,\n  z,\n}: {\n  centerX: number;\n  centerY: number;\n  countX: number;\n  countY: number;\n  x: number;\n  y: number;\n  z: number;\n}) => {\n  const images: HTMLImageElement[] = [];\n  for (let dy = 0 - countY; dy <= countY; dy++) {\n    if (y + dy < 0) continue;\n    if (y + dy >= 1 << z) continue;\n    for (let dx = 0 - countX; dx <= countX; dx++) {\n      const image = createHTMLElement({\n        src: `http://localhost:3000/tile/${position.source}/${[\n          z,\n          Math.floor(x + dx).toString(16),\n          Math.floor(y + dy).toString(16),\n        ].join('/')}?ttl=1`,\n        style: {\n          left: `${centerX + (dx - x + Math.floor(x)) * tileSize}px`,\n          position: 'absolute',\n          top: `${centerY + (dy - y + Math.floor(y)) * tileSize}px`,\n        },\n        tag: 'img',\n      });\n      images.push(image);\n    }\n  }\n  return images;\n};\n\nif (container) {\n  const redraw = () => {\n    console.log('redraw');\n    const { height, width } = container.getBoundingClientRect();\n\n    const viewport = {\n      centerX: Math.round(width / 2),\n      centerY: Math.round(height / 2),\n    };\n    const countX = Math.ceil(viewport.centerX / tileSize);\n    const countY = Math.ceil(viewport.centerY / tileSize);\n    container.innerHTML = '';\n    container.append(...createImages({\n      centerX: viewport.centerX,\n      centerY: viewport.centerY,\n      countX,\n      countY,\n      x: position.x,\n      y: position.y,\n      z: position.z,\n    }));\n    container.append(createHTMLElement({\n      style: {\n        left: '0px',\n        position: 'absolute',\n        textShadow: '0 0 5px white',\n        top: '0px',\n      },\n      tag: 'div',\n      zhilds: [\n        `Zoom: ${position.z}`,\n        createHTMLElement({ tag: 'br' }),\n        'Lat: X',\n        createHTMLElement({ tag: 'br' }),\n        'Lon: X',\n      ],\n    }));\n  };\n\n  window.onwheel = (event) => {\n    event;\n  };\n\n  const onchange = (event: KeyboardEvent | WheelEvent | MouseEvent) => {\n    const zoomIn = () => {\n      if (position.z < 20) {\n        position.z++;\n        position.x *= 2;\n        position.y *= 2;\n      }\n    };\n    const zoomOut = () => {\n      if (position.z > 2) {\n        position.z--;\n        position.x /= 2;\n        position.y /= 2;\n      }\n    };\n    const { type } = event;\n    if (event instanceof WheelEvent) {\n      const { clientX, clientY, deltaY } = event;\n      const { height, width } = container.getBoundingClientRect();\n\n      if (deltaY > 0) {\n        zoomOut();\n        position.x -= (clientX - width / 2) / tileSize / 2;\n        position.y -= (clientY - height / 2) / tileSize / 2;\n      }\n      else if (deltaY < 0) {\n        zoomIn();\n        position.x += (clientX - width / 2) / tileSize;\n        position.y += (clientY - height / 2) / tileSize;\n      }\n      else {\n        console.log('noop', { deltaY, type });\n        return;\n      }\n    }\n    else if (event instanceof KeyboardEvent) {\n      if (event.isComposing) return;\n      const { key } = event;\n      if (key === 'ArrowLeft') position.x--;\n      else if (key === 'ArrowRight') position.x++;\n      else if (key === 'ArrowUp') position.y--;\n      else if (key === 'ArrowDown') position.y++;\n      else if (key === '+') zoomIn();\n      else if (key === '-') zoomOut();\n      else if (key === '1') position.source = 'osm';\n      else if (key === '2') position.source = 'googlesat';\n      else if (key === '3') position.source = 'navionics';\n      else if (key === '4') position.source = 'googlestreet';\n      else if (key === '5') position.source = 'googlehybrid';\n      else if (key === '6') position.source = 'gebco';\n      else {\n        console.log('noop', { key, type });\n        return;\n      }\n    }\n\n    position.y = Math.max(0, Math.min(position.y, (1 << position.z) - 1));\n\n    const newlocation = `${\n      window.location.origin\n    }${\n      window.location.pathname\n    }?${\n      Object.entries(position)\n      .map(([k, v]) => `${k}=${v}`)\n      .join('&')\n    }`;\n    window.history.pushState({ path: newlocation }, '', newlocation);\n\n    redraw();\n  };\n  window.addEventListener('keydown', onchange);\n  window.addEventListener('wheel', onchange);\n  window.addEventListener('mousedown', onchange);\n\n  redraw();\n}\n"],
  "mappings": "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",
  "names": []
}
