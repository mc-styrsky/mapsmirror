{
  "version": 3,
  "sources": ["../src/client/createHTMLElement.ts", "../src/client/index.ts"],
  "sourcesContent": ["export function createHTMLElement<T extends keyof HTMLElementTagNameMap> (params: Partial<Omit<HTMLElementTagNameMap[T], 'dataset' | 'style'>> & {\n  classes?: string[];\n  dataset?: Partial<HTMLElementTagNameMap[T]['dataset']>,\n  style?: Partial<HTMLElementTagNameMap[T]['style']>;\n  tag: T;\n  zhilds?: (HTMLElement | string | null | undefined)[];\n}): HTMLElementTagNameMap[T] {\n  const { classes, dataset, style, tag, zhilds, ...data } = params;\n\n  const element = document.createElement(tag);\n\n  Object.entries(data).forEach(([k, v]) => element[k] = v);\n\n  if (classes) classes.forEach(c => element.classList.add(c));\n  if (dataset) Object.entries(dataset).forEach(([k, v]) => element.dataset[k] = v);\n  if (style) Object.entries(style).forEach(([k, v]) => element.style[k] = v);\n  if (zhilds) zhilds.forEach(child => {\n    if (!child) return;\n    if (typeof child === 'string') element.append(document.createTextNode(child));\n    else element.append(child);\n  });\n  return element;\n}\n", "import { createHTMLElement } from './createHTMLElement';\nconst {\n  container: containerId = '',\n} = Object.fromEntries(new URL(import.meta.url).searchParams.entries());\n\nconst container = document.getElementById(containerId);\nconst position = {\n  x: 1,\n  y: 1,\n  z: 1,\n};\n\nconst tileSize = 256;\n\nconst createImages = ({\n  centerX,\n  centerY,\n  countX,\n  countY,\n  x,\n  y,\n  z,\n}: {\n  centerX: number;\n  centerY: number;\n  countX: number;\n  countY: number;\n  x: number;\n  y: number;\n  z: number;\n}) => {\n  console.log({\n    centerX,\n    centerY,\n    countX,\n    countY,\n    x,\n    y,\n    z,\n  });\n  const images: HTMLImageElement[] = [];\n  for (let dy = 0 - countY; dy <= countY; dy++) {\n    if (y + dy < 0) continue;\n    if (y + dy >= 1 << z) continue;\n    for (let dx = 0 - countX; dx <= countX; dx++) {\n      console.log({ countX, countY, x: dx, y: dy });\n      const image = createHTMLElement({\n        src: `http://localhost:3000/tile/osm/${[\n          z,\n          Math.floor(x + dx).toString(16),\n          Math.floor(y + dy).toString(16),\n        ].join('/')}?ttl=6`,\n        style: {\n          left: `${centerX + (dx - x + Math.floor(x)) * tileSize}px`,\n          position: 'absolute',\n          top: `${centerY + (dy - y + Math.floor(y)) * tileSize}px`,\n        },\n        tag: 'img',\n      });\n      images.push(image);\n    }\n  }\n  return images;\n};\n\nif (container) {\n  const redraw = () => {\n    console.log('redraw');\n    const { height, width } = container.getBoundingClientRect();\n\n    const viewport = {\n      centerX: Math.round(width / 2),\n      centerY: Math.round(height / 2),\n    };\n    const countX = Math.ceil(viewport.centerX / tileSize);\n    const countY = Math.ceil(viewport.centerY / tileSize);\n    container.innerHTML = '';\n    container.append(...createImages({\n      centerX: viewport.centerX,\n      centerY: viewport.centerY,\n      countX,\n      countY,\n      x: position.x,\n      y: position.y,\n      z: position.z,\n    }));\n  };\n\n  window.addEventListener('keydown', (event: KeyboardEvent) => {\n    if (event.isComposing) return;\n    const { key } = event;\n    if (key === 'ArrowLeft') position.x--;\n    else if (key === 'ArrowRight') position.x++;\n    else if (key === 'ArrowUp') position.y--;\n    else if (key === 'ArrowDown') position.y++;\n    else if (key === '+' && position.z < 17) {\n      position.z++;\n      position.x *= 2;\n      position.y *= 2;\n    }\n    else if (key === '-' && position.z > 0) {\n      position.z--;\n      position.x /= 2;\n      position.y /= 2;\n    }\n    else {\n      console.log('noop', { event, key });\n      return;\n    }\n\n    position.y = Math.max(0, Math.min(position.y, (1 << position.z) - 1));\n\n    console.log('v2', { event, key });\n    redraw();\n  });\n  redraw();\n}\n"],
  "mappings": "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",
  "names": []
}
